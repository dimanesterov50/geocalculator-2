<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–µ—Ä–µ–≤–æ–¥ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –≤ –≥—Ä–∞–º–º—ã –∏ –ø–æ–∫–∞–∑–∞–Ω–∏—è –∞—Ä–µ–æ–º–µ—Ç—Ä–∞</title>
    <style>
        * { box-sizing: border-box; }
        html, body {
            width: 100%;
            max-width: 100%;
            overflow-x: hidden;
        }
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #ffffff;
            padding: 20px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200"><g fill="none" stroke="%23002f4b" stroke-opacity="0.05" stroke-width="3"><ellipse cx="30" cy="40" rx="5" ry="8"/><ellipse cx="120" cy="60" rx="7" ry="10"/><polygon points="170,90 180,100 160,100" /><ellipse cx="80" cy="140" rx="6" ry="4"/><polygon points="20,160 30,170 15,175" /><ellipse cx="150" cy="180" rx="4" ry="7"/><path d="M50,50 Q60,40 70,50 T90,50" /><path d="M100,120 Q110,130 120,120 T140,120" /></g></svg>');
            background-repeat: repeat;
            background-size: 200px;
        }
        .top-menu {
            position: fixed;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 10px;
            z-index: 10;
        }
        .top-menu button {
            padding: 12px 16px;
            border-radius: 12px;
            border: 2px solid #2c3e50;
            background-color: #2c3e50;
            color: white;
            cursor: pointer;
            font-size: 20px;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        .top-menu button:hover { background-color: #34495e; }
        .header-text {
            max-width: 800px;
            margin: 40px auto 40px auto;
            text-align: center;
            position: relative;
            z-index: 1;
        }
        .header-text h1 {
            font-size: 24px;
            color: #2c3e50;
            margin: 0 0 12px;
        }
        .header-text p {
            font-size: 16px;
            color: #000;
            margin: 0;
        }
        .calculation-container {
            border: 2px solid #2c3e50;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            background-color: rgba(255,255,255,0.9);
            max-width: 1000px;
            margin: 0 auto 30px;
        }
        .input-section { margin-bottom: 20px; }
        .input-section h4 {
            margin: 0 0 10px;
            font-size: 17px;
            color: #2c3e50;
        }
        .input-row {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }
        .input-group {
            flex: 1;
            min-width: 160px;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 13px;
            color: #2c3e50;
        }
        input[type="number"] {
            width: 100%;
            padding: 7px 8px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 14px;
        }
        input.default { background-color: #fff8e1; }
        .result-table {
            margin-top: 12px;                    /* ‚Üê —á—É—Ç—å –º–µ–Ω—å—à–µ */
            width: 100%;
            border-collapse: separate;
            border-spacing: 1px;                 /* ‚Üê —É–º–µ–Ω—å—à–µ–Ω–æ —Å 2px */
        }
        .result-table th, .result-table td {
            border: 1px solid #d3dce6;
            padding: 6px;                        /* ‚Üê —É–º–µ–Ω—å—à–µ–Ω–æ —Å 7px */
            text-align: center;
            font-size: 12px;                     /* ‚Üê —É–º–µ–Ω—å—à–µ–Ω–æ —Å 13px */
        }
        .result-table th {
            background: #2c3e50;
            color: white;
            font-weight: bold;
        }
        .result-table td {
            background: #f8fbff;
            color: #1a73e8;
            font-weight: bold;
        }
        .action-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        .btn-calc-green {
            padding: 10px 18px;
            border-radius: 12px;
            border: 2px solid #2e7d32;
            background: #2e7d32;
            color: white;
            cursor: pointer;
            font-size: 15px;
            font-weight: bold;
        }
        .btn-calc-green:hover { background: #388e3c; }
        .btn-clear {
            padding: 10px 18px;
            border-radius: 12px;
            border: 1px solid #7f8c8d;
            background: #ecf0f1;
            color: #2c3e50;
            cursor: pointer;
            font-size: 15px;
        }
        .btn-clear:hover { background: #bdc3c7; }
        .btn-copy {
            padding: 8px 14px;
            border-radius: 10px;
            border: 1px solid #4fc3f7;
            background: #4fc3f7;
            color: white;
            cursor: pointer;
            font-size: 14px;
            display: none;
        }
        .btn-copy.copied {
            background: #81c784;
            border-color: #81c784;
        }
        .btn-copy:hover { background: #29b6f6; }
        .copy-notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 20px;
            background: #2e7d32;
            color: white;
            border-radius: 8px;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 40;
        }
        .copy-notification.show { opacity: 1; }
        .test-flex {
            opacity: 0;
            transform: translateY(20px);
            animation: slideIn 0.5s ease forwards;
        }
        @keyframes slideIn {
            to { opacity: 1; transform: translateY(0); }
        }
        @media (max-width: 768px) {
            body { padding-top: 60px; }
            .input-row { flex-direction: column; }
            .input-group { min-width: 100%; }
            .action-row { flex-direction: column; }
            .result-table { font-size: 11px; }   /* –µ—â—ë –º–µ–Ω—å—à–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
        }
    </style>
</head>
<body>

    <div class="top-menu">
        <button onclick="location.href='https://geocalculator.ru/index.html'" aria-label="–ù–∞ –≥–ª–∞–≤–Ω—É—é">üè†</button>
    </div>

    <div class="header-text">
        <h1>–ü–µ—Ä–µ–≤–æ–¥ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –≤ –≥—Ä–∞–º–º—ã –∏ –ø–æ–∫–∞–∑–∞–Ω–∏—è –∞—Ä–µ–æ–º–µ—Ç—Ä–∞</h1>
        <p>–û–±—Ä–∞—Ç–Ω—ã–π —Ä–∞—Å—á—ë—Ç –∫ –ì–û–°–¢ 12536-2014. –í–≤–µ–¥–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –ø–æ–ª—è –Ω–∏–∂–µ.<br>–ó–Ω–∞—á–µ–Ω–∏—è –Ω–∞–≤–µ—Å–∫–∏ –∞—Ä–µ–æ–º–µ—Ç—Ä–∞ –∏ –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ —á–∞—Å—Ç–∏—Ü —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏ –º–æ–≥—É—Ç –±—ã—Ç—å –∏–∑–º–µ–Ω–µ–Ω—ã.</p>
    </div>

    <div id="tests-container">
        <div class="test-flex">
            <div class="calculation-container">

                <div class="input-section">
                    <h4>–í–µ—Å–∞ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h4>
                    <div class="input-row">
                        <div class="input-group">
                            <label>–û–±—â–∏–π –≤–µ—Å –ø—Ä–æ–±—ã, –≥</label>
                            <input type="number" step="any" class="total-weight">
                        </div>
                        <div class="input-group">
                            <label>–ù–∞–≤–µ—Å–∫–∞ –∞—Ä–µ–æ–º–µ—Ç—Ä–∞, –≥</label>
                            <input type="number" step="any" class="hydrometer-sample default" value="30">
                        </div>
                        <div class="input-group">
                            <label>–ü–ª–æ—Ç–Ω–æ—Å—Ç—å —á–∞—Å—Ç–∏—Ü, –≥/—Å–º¬≥</label>
                            <input type="number" step="any" class="particle-density default" value="2.7">
                        </div>
                    </div>
                </div>

                <div class="input-section">
                    <h4>–ü–æ–ø—Ä–∞–≤–∫–∏ –∞—Ä–µ–æ–º–µ—Ç—Ä–∞, –≥/–ª</h4>
                    <div class="input-row">
                        <div class="input-group">
                            <label>1 –º–∏–Ω</label>
                            <input type="number" step="any" class="correction-1min">
                        </div>
                        <div class="input-group">
                            <label>30 –º–∏–Ω</label>
                            <input type="number" step="any" class="correction-30min">
                        </div>
                        <div class="input-group">
                            <label>11 —á</label>
                            <input type="number" step="any" class="correction-11h">
                        </div>
                    </div>
                </div>

                <div class="input-section">
                    <h4>–ü—Ä–æ—Ü–µ–Ω—Ç–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ, %</h4>
                    <div class="input-row">
                        <div class="input-group"><label>>10 –º–º</label><input type="number" step="any" class="percent-over-10"></div>
                        <div class="input-group"><label>10-2 –º–º</label><input type="number" step="any" class="percent-10-2"></div>
                        <div class="input-group"><label>2-1 –º–º</label><input type="number" step="any" class="percent-2-1"></div>
                        <div class="input-group"><label>1-0.5 –º–º</label><input type="number" step="any" class="percent-1-0_5"></div>
                        <div class="input-group"><label>0.5-0.25 –º–º</label><input type="number" step="any" class="percent-0_5-0_25"></div>
                        <div class="input-group"><label>0.25-0.1 –º–º</label><input type="number" step="any" class="percent-0_25-0_1"></div>
                        <div class="input-group"><label>0.1-0.05 –º–º</label><input type="number" step="any" class="percent-0_1-0_05"></div>
                        <div class="input-group"><label>0.05-0.01 –º–º</label><input type="number" step="any" class="percent-0_05-0_01"></div>
                        <div class="input-group"><label>0.01-0.002 –º–º</label><input type="number" step="any" class="percent-0_01-0_002"></div>
                        <div class="input-group"><label><0.002 –º–º</label><input type="number" step="any" class="percent-under-0_002"></div>
                    </div>
                </div>

                <table class="result-table grams-table">
                    <tr>
                        <th>>10</th><th>10-2</th><th>2-1</th><th>1-0.5</th><th>0.5-0.25</th><th>0.25-0.1</th>
                    </tr>
                    <tr>
                        <td class="grams-over-10">-</td>
                        <td class="grams-10-2">-</td>
                        <td class="grams-2-1">-</td>
                        <td class="grams-1-0_5">-</td>
                        <td class="grams-0_5-0_25">-</td>
                        <td class="grams-0_25-0_1">-</td>
                    </tr>
                </table>

                <table class="result-table hydrometer-table">
                    <tr>
                        <th>–ê—Ä–µ–æ–º–µ—Ç—Ä 1 –º–∏–Ω (–≥/–ª)</th>
                        <th>–ê—Ä–µ–æ–º–µ—Ç—Ä 30 –º–∏–Ω (–≥/–ª)</th>
                        <th>–ê—Ä–µ–æ–º–µ—Ç—Ä 11 —á (–≥/–ª)</th>
                    </tr>
                    <tr>
                        <td class="hydrometer-1min">-</td>
                        <td class="hydrometer-30min">-</td>
                        <td class="hydrometer-11h">-</td>
                    </tr>
                </table>

                <div class="action-row">
                    <div>
                        <button class="btn-calc-green" onclick="App.calculate()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
                        <button class="btn-clear" onclick="App.clear()">–û—á–∏—Å—Ç–∏—Ç—å</button>
                    </div>
                    <button class="btn-copy" onclick="App.copyResults(this)">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>

            </div>
        </div>
    </div>

    <div class="copy-notification" id="copy-notification">–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!</div>

    <script>
        const App = {
            settings: {
                add2_1mm: true,
                rounding: 1
            },
            init() {
                document.addEventListener('DOMContentLoaded', () => {
                    this.setupEnterNavigation();
                });
            },
            setupEnterNavigation() {
                const container = document.querySelector(".calculation-container");
                const inputs = Array.from(container.querySelectorAll('input[type="number"]'));
                inputs.forEach((input, idx) => {
                    input.addEventListener('keydown', e => {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            if (idx < inputs.length - 1) {
                                inputs[idx + 1].focus();
                            } else {
                                container.querySelector('.btn-calc-green').click();
                            }
                        }
                    });
                });
            },
            calculate() {
                const container = document.querySelector(".calculation-container");
                const get = sel => parseFloat(container.querySelector(sel)?.value) || 0;

                const totalWeight     = get(".total-weight");
                const hydrometerSample = get(".hydrometer-sample");
                const particleDensity  = get(".particle-density");
                const corr1min = get(".correction-1min");
                const corr30min = get(".correction-30min");
                const corr11h  = get(".correction-11h");

                const percentages = {
                    'over-10':     get(".percent-over-10"),
                    '10-2':        get(".percent-10-2"),
                    '2-1':         get(".percent-2-1"),
                    '1-0_5':       get(".percent-1-0_5"),
                    '0_5-0_25':    get(".percent-0_5-0_25"),
                    '0_25-0_1':    get(".percent-0_25-0_1"),
                    '0_1-0_05':    get(".percent-0_1-0_05"),
                    '0_05-0_01':   get(".percent-0_05-0_01"),
                    '0_01-0_002':  get(".percent-0_01-0_002"),
                    'under-0_002': get(".percent-under-0_002")
                };

                if (totalWeight <= 0) return alert("–û–±—â–∏–π –≤–µ—Å –ø—Ä–æ–±—ã –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å > 0");
                if (hydrometerSample <= 0 && ['2-1','1-0_5','0_5-0_25','0_25-0_1','0_1-0_05','0_05-0_01','0_01-0_002','under-0_002'].some(k => percentages[k] > 0)) {
                    return alert("–ù–∞–≤–µ—Å–∫–∞ –∞—Ä–µ–æ–º–µ—Ç—Ä–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å > 0 –ø—Ä–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Ç–æ–Ω–∫–∏—Ö —Ñ—Ä–∞–∫—Ü–∏—è—Ö");
                }
                if (particleDensity <= 1 && ['0_1-0_05','0_05-0_01','0_01-0_002','under-0_002'].some(k => percentages[k] > 0)) {
                    return alert("–ü–ª–æ—Ç–Ω–æ—Å—Ç—å —á–∞—Å—Ç–∏—Ü –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å > 1 –¥–ª—è –∞—Ä–µ–æ–º–µ—Ç—Ä–∞");
                }
                const sumPct = Object.values(percentages).reduce((a,b)=>a+b,0);
                if (Math.abs(sumPct - 100) > 0.1) {
                    return alert(`–°—É–º–º–∞ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ ‚âà ${sumPct.toFixed(1)}% (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 100%)`);
                }

                const gramsResults = {};
                const coarseFractions = ['over-10', '10-2'];
                const fineFractions = this.settings.add2_1mm
                    ? ['2-1', '1-0_5', '0_5-0_25', '0_25-0_1']
                    : ['1-0_5', '0_5-0_25', '0_25-0_1'];

                coarseFractions.forEach(f => {
                    gramsResults[f] = (percentages[f] * totalWeight) / 100;
                });

                const coarseSum = coarseFractions.reduce((a,f)=>a + percentages[f], 0);

                if (this.settings.add2_1mm) {
                    gramsResults['2-1'] = hydrometerSample > 0 ? (percentages['2-1'] * hydrometerSample) / (100 - coarseSum) : 0;
                } else {
                    gramsResults['2-1'] = (percentages['2-1'] * totalWeight) / 100;
                }

                fineFractions.forEach(f => {
                    if (f !== '2-1') {
                        gramsResults[f] = hydrometerSample > 0 ? (percentages[f] * hydrometerSample) / (100 - coarseSum) : 0;
                    }
                });

                const rounding = this.settings.rounding;
                const roundedGrams = {};
                Object.keys(gramsResults).forEach(k => {
                    roundedGrams[k] = Number(gramsResults[k].toFixed(rounding));
                });

                const hydrCum = {};
                hydrCum['11h']   = percentages['under-0_002'];
                hydrCum['30min'] = percentages['0_01-0_002'] + hydrCum['11h'];
                hydrCum['1min']  = percentages['0_05-0_01'] + hydrCum['30min'];

                const hydrRead = {};
                if (particleDensity > 1 && hydrometerSample > 0) {
                    const denom = particleDensity * (100 - coarseSum);
                    hydrRead['1min']  = (hydrCum['1min']  * (particleDensity - 1) * hydrometerSample) / denom;
                    hydrRead['30min'] = (hydrCum['30min'] * (particleDensity - 1) * hydrometerSample) / denom;
                    hydrRead['11h']   = (hydrCum['11h']   * (particleDensity - 1) * hydrometerSample) / denom;
                } else {
                    hydrRead['1min'] = hydrRead['30min'] = hydrRead['11h'] = 0;
                }

                const rawHydr = {
                    '1min':  hydrRead['1min']  - corr1min,
                    '30min': hydrRead['30min'] - corr30min,
                    '11h':   hydrRead['11h']   - corr11h
                };

                const roundedHydr = {};
                Object.keys(rawHydr).forEach(k => {
                    roundedHydr[k] = Number(rawHydr[k].toFixed(rounding));
                });

                container.querySelectorAll(".grams-table td").forEach(td => {
                    const frac = td.className.replace("grams-", "");
                    td.textContent = roundedGrams[frac] ?? "-";
                });

                container.querySelectorAll(".hydrometer-table td").forEach(td => {
                    const t = td.className.replace("hydrometer-", "");
                    td.textContent = roundedHydr[t] ?? "-";
                });

                container.querySelector(".btn-copy").style.display = "inline-block";
            },

            clear() {
                const container = document.querySelector(".calculation-container");
                container.querySelectorAll("input:not(.default)").forEach(i => i.value = "");
                container.querySelectorAll(".result-table td").forEach(td => td.textContent = "-");
                container.querySelector(".btn-copy").style.display = "none";
            },

            copyResults(btn) {
                const container = btn.closest(".calculation-container");
                const cells = [
                    ...container.querySelectorAll(".grams-table td"),
                    ...container.querySelectorAll(".hydrometer-table td")
                ];
                const text = Array.from(cells).map(td => td.textContent.trim()).join("\t");
                navigator.clipboard.writeText(text).then(() => {
                    btn.classList.add("copied");
                    btn.textContent = "–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ! ‚úÖ";
                    const notif = document.getElementById("copy-notification");
                    notif.classList.add("show");
                    setTimeout(() => {
                        notif.classList.remove("show");
                        btn.classList.remove("copied");
                        btn.textContent = "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å";
                    }, 2000);
                }).catch(() => alert("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å"));
            }
        };

        App.init();
    </script>
</body>
</html>