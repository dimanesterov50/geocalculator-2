<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Перевод процентов в граммы и показания ареометра</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            max-width: 1000px;
            margin: 20px auto;
            padding: 0 20px;
            background-color: #f4f7fa;
            color: #2c3e50;
            text-align: center;
        }
        h1 {
            font-size: 28px;
            margin-bottom: 20px;
            color: #2c3e50;
        }
        .calculation-container {
            background-color: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid #e0e6ed;
            margin: 0 auto;
        }
        .input-section h4 {
            margin: 0 0 12px;
            font-size: 18px;
            color: #2c3e50;
            font-weight: 600;
        }
        .input-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-bottom: 15px;
        }
        .input-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 150px;
        }
        .input-group label {
            font-size: 14px;
            color: #2c3e50;
            margin-bottom: 5px;
            font-weight: 500;
        }
        .input-group input {
            padding: 8px;
            border-radius: 6px;
            border: 1px solid #d0d7de;
            font-size: 14px;
            width: 100%;
            max-width: 150px;
            text-align: center;
            transition: border-color 0.3s;
        }
        .input-group input.default {
            background-color: #fff3e0;
        }
        .input-group input:focus {
            outline: none;
            border-color: #1a73e8;
            box-shadow: 0 0 5px rgba(26, 115, 232, 0.2);
        }
        .grams-table, .hydrometer-table {
            width: 100%;
            max-width: 600px;
            border-collapse: separate;
            border-spacing: 0;
            margin: 20px auto;
            border-radius: 8px;
            overflow: hidden;
        }
        .grams-table th, .grams-table td, .hydrometer-table th, .hydrometer-table td {
            padding: 10px;
            text-align: center;
            font-size: 14px;
            border: 1px solid #e0e6ed;
        }
        .grams-table th, .hydrometer-table th {
            background-color: #2c3e50;
            color: white;
            font-weight: 600;
        }
        .grams-table td, .hydrometer-table td {
            background-color: #f9fafc;
            color: #1a73e8;
            font-weight: 500;
        }
        .grams-table tr:nth-child(even) td, .hydrometer-table tr:nth-child(even) td {
            background-color: #f1f4f8;
        }
        .grams-table tr:hover td, .hydrometer-table tr:hover td {
            background-color: #e8ecef;
        }
        .action-row {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            width: 100%;
        }
        .btn-calc, .btn-clear {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
        }
        .btn-calc {
            border: 2px solid #2e7d32;
            background-color: #2e7d32;
            color: white;
        }
        .btn-calc:hover {
            background-color: #388e3c;
            transform: translateY(-1px);
        }
        .btn-clear {
            border: 1px solid #7f8c8d;
            background-color: #ecf0f1;
            color: #2c3e50;
        }
        .btn-clear:hover {
            background-color: #bdc3c7;
            transform: translateY(-1px);
        }
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 20px;
            border-radius: 6px;
            color: white;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }
        .notification.success {
            background-color: #2e7d32;
        }
        .notification.error {
            background-color: #e74c3c;
        }
        .notification.show {
            opacity: 1;
        }
        @media screen and (max-width: 600px) {
            .input-row {
                flex-direction: column;
            }
            .input-group {
                min-width: 100%;
            }
            .input-group input {
                max-width: 100%;
            }
            .grams-table, .hydrometer-table {
                font-size: 12px;
            }
            .grams-table th, .grams-table td, .hydrometer-table th, .hydrometer-table td {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <h1>Перевод процентов в граммы и показания ареометра</h1>
    <div class="calculation-container">
        <div class="input-section">
            <h4>Веса и параметры</h4>
            <div class="input-row">
                <div class="input-group">
                    <label for="total-weight">Общий вес, г</label>
                    <input type="number" step="any" id="total-weight" class="total-weight" aria-label="Общий вес пробы">
                </div>
                <div class="input-group">
                    <label for="hydrometer-sample">Навеска ареометра, г</label>
                    <input type="number" step="any" id="hydrometer-sample" class="hydrometer-sample default" value="30" aria-label="Масса навески для ареометра">
                </div>
                <div class="input-group">
                    <label for="particle-density">Плотность частиц, г/см³</label>
                    <input type="number" step="any" id="particle-density" class="particle-density default" value="2.7" aria-label="Плотность частиц грунта">
                </div>
            </div>
            <h4>Поправки</h4>
            <div class="input-row">
                <div class="input-group">
                    <label for="correction-1min">Поправка 1 мин, г/л</label>
                    <input type="number" step="any" id="correction-1min" class="correction-1min" aria-label="Поправка для ареометра 1 минута">
                </div>
                <div class="input-group">
                    <label for="correction-30min">Поправка 30 мин, г/л</label>
                    <input type="number" step="any" id="correction-30min" class="correction-30min" aria-label="Поправка для ареометра 30 минут">
                </div>
                <div class="input-group">
                    <label for="correction-11h">Поправка 11 ч, г/л</label>
                    <input type="number" step="any" id="correction-11h" class="correction-11h" aria-label="Поправка для ареометра 11 часов">
                </div>
            </div>
            <h4>Процентное содержание фракций, %</h4>
            <div class="input-row">
                <div class="input-group">
                    <label for="percent-over-10">>10 мм, %</label>
                    <input type="number" step="any" id="percent-over-10" class="percent-over-10" aria-label="Процент фракции >10 мм">
                </div>
                <div class="input-group">
                    <label for="percent-10-2">10-2 мм, %</label>
                    <input type="number" step="any" id="percent-10-2" class="percent-10-2" aria-label="Процент фракции 10-2 мм">
                </div>
                <div class="input-group">
                    <label for="percent-2-1">2-1 мм, %</label>
                    <input type="number" step="any" id="percent-2-1" class="percent-2-1" aria-label="Процент фракции 2-1 мм">
                </div>
                <div class="input-group">
                    <label for="percent-1-0_5">1-0.5 мм, %</label>
                    <input type="number" step="any" id="percent-1-0_5" class="percent-1-0_5" aria-label="Процент фракции 1-0.5 мм">
                </div>
                <div class="input-group">
                    <label for="percent-0_5-0_25">0.5-0.25 мм, %</label>
                    <input type="number" step="any" id="percent-0_5-0_25" class="percent-0_5-0_25" aria-label="Процент фракции 0.5-0.25 мм">
                </div>
                <div class="input-group">
                    <label for="percent-0_25-0_1">0.25-0.1 мм, %</label>
                    <input type="number" step="any" id="percent-0_25-0_1" class="percent-0_25-0_1" aria-label="Процент фракции 0.25-0.1 мм">
                </div>
                <div class="input-group">
                    <label for="percent-0_1-0_05">0.1-0.05 мм, %</label>
                    <input type="number" step="any" id="percent-0_1-0_05" class="percent-0_1-0_05" aria-label="Процент фракции 0.1-0.05 мм">
                </div>
                <div class="input-group">
                    <label for="percent-0_05-0_01">0.05-0.01 мм, %</label>
                    <input type="number" step="any" id="percent-0_05-0_01" class="percent-0_05-0_01" aria-label="Процент фракции 0.05-0.01 мм">
                </div>
                <div class="input-group">
                    <label for="percent-0_01-0_002">0.01-0.002 мм, %</label>
                    <input type="number" step="any" id="percent-0_01-0_002" class="percent-0_01-0_002" aria-label="Процент фракции 0.01-0.002 мм">
                </div>
                <div class="input-group">
                    <label for="percent-under-0_002"><0.002 мм, %</label>
                    <input type="number" step="any" id="percent-under-0_002" class="percent-under-0_002" aria-label="Процент фракции <0.002 мм">
                </div>
            </div>
        </div>
        <table class="grams-table">
            <tr>
                <th>>10 мм</th><th>10-2 мм</th><th>2-1 мм</th><th>1-0.5 мм</th><th>0.5-0.25 мм</th><th>0.25-0.1 мм</th>
            </tr>
            <tr>
                <td class="grams-over-10">-</td>
                <td class="grams-10-2">-</td>
                <td class="grams-2-1">-</td>
                <td class="grams-1-0_5">-</td>
                <td class="grams-0_5-0_25">-</td>
                <td class="grams-0_25-0_1">-</td>
            </tr>
        </table>
        <table class="hydrometer-table">
            <tr>
                <th>Ареометр, 1 мин (г/л)</th><th>Ареометр, 30 мин (г/л)</th><th>Ареометр, 11 ч (г/л)</th>
            </tr>
            <tr>
                <td class="hydrometer-1min">-</td>
                <td class="hydrometer-30min">-</td>
                <td class="hydrometer-11h">-</td>
            </tr>
        </table>
        <div class="action-row">
            <button class="btn-calc" onclick="App.calculate()">Рассчитать</button>
            <button class="btn-clear" onclick="App.clear()">Очистить</button>
        </div>
    </div>
    <div class="notification" id="notification"></div>
    <script>
        const App = {
            settings: {
                add2_1mm: true, // Include 2-1 mm in hydrometer sample
                rounding: 1 // Round to 1 decimal place
            },

            init() {
                this.setupEnterNavigation();
            },

            setupEnterNavigation() {
                const inputs = [
                    '.total-weight',
                    '.correction-1min',
                    '.correction-30min',
                    '.correction-11h',
                    '.percent-over-10',
                    '.percent-10-2',
                    '.percent-2-1',
                    '.percent-1-0_5',
                    '.percent-0_5-0_25',
                    '.percent-0_25-0_1',
                    '.percent-0_1-0_05',
                    '.percent-0_05-0_01',
                    '.percent-0_01-0_002',
                    '.percent-under-0_002'
                ].map(selector => document.querySelector(selector));
                inputs.forEach(input => {
                    input.addEventListener('keydown', (event) => {
                        if (event.key === 'Enter') {
                            event.preventDefault();
                            const currentIndex = inputs.indexOf(event.target);
                            if (currentIndex < inputs.length - 1) {
                                inputs[currentIndex + 1].focus();
                            } else {
                                document.querySelector('.btn-calc').click();
                            }
                        }
                    });
                });
            },

            showNotification(message, type) {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.className = `notification ${type} show`;
                setTimeout(() => {
                    notification.className = 'notification';
                }, 3000);
            },

            calculate() {
                const calcDiv = document.querySelector(".calculation-container");
                const getValue = (selector) => parseFloat(calcDiv.querySelector(selector).value) || 0;

                // Input values
                const totalWeight = getValue(".total-weight");
                const hydrometerSample = getValue(".hydrometer-sample");
                const particleDensity = getValue(".particle-density");
                const correction1min = getValue(".correction-1min");
                const correction30min = getValue(".correction-30min");
                const correction11h = getValue(".correction-11h");
                const percentages = {
                    'over-10': getValue(".percent-over-10"),
                    '10-2': getValue(".percent-10-2"),
                    '2-1': getValue(".percent-2-1"),
                    '1-0_5': getValue(".percent-1-0_5"),
                    '0_5-0_25': getValue(".percent-0_5-0_25"),
                    '0_25-0_1': getValue(".percent-0_25-0_1"),
                    '0_1-0_05': getValue(".percent-0_1-0_05"),
                    '0_05-0_01': getValue(".percent-0_05-0_01"),
                    '0_01-0_002': getValue(".percent-0_01-0_002"),
                    'under-0_002': getValue(".percent-under-0_002")
                };

                // Validation
                if (totalWeight <= 0) {
                    this.showNotification("Ошибка: Общий вес пробы должен быть больше 0", "error");
                    return;
                }
                if (hydrometerSample <= 0 && Object.keys(percentages).some(key => percentages[key] > 0 && ['2-1', '1-0_5', '0_5-0_25', '0_25-0_1', '0_1-0_05', '0_05-0_01', '0_01-0_002', 'under-0_002'].includes(key))) {
                    this.showNotification("Ошибка: Масса навески ареометра должна быть больше 0, если введены проценты для фракций 2-1 мм и мельче", "error");
                    return;
                }
                if (particleDensity <= 1 && Object.keys(percentages).some(key => percentages[key] > 0 && ['0_1-0_05', '0_05-0_01', '0_01-0_002', 'under-0_002'].includes(key))) {
                    this.showNotification("Ошибка: Плотность частиц должна быть больше 1 для расчёта показаний ареометра", "error");
                    return;
                }
                const percentSum = Object.values(percentages).reduce((acc, val) => acc + val, 0);
                if (Math.abs(percentSum - 100) > 0.1) {
                    this.showNotification(`Ошибка: Сумма процентов (${percentSum.toFixed(1)}) должна быть равна 100`, "error");
                    return;
                }

                // Calculate masses in grams for fractions >= 0.1 mm
                const gramsResults = {};
                const coarseFractions = ['over-10', '10-2'];
                const fineFractions = this.settings.add2_1mm
                    ? ['2-1', '1-0_5', '0_5-0_25', '0_25-0_1']
                    : ['1-0_5', '0_5-0_25', '0_25-0_1'];

                // Coarse fractions
                coarseFractions.forEach(fraction => {
                    gramsResults[fraction] = (percentages[fraction] * totalWeight) / 100;
                });

                // Sum of coarse fractions percentages
                const coarseSum = coarseFractions.reduce((acc, fraction) => acc + percentages[fraction], 0);

                // 2-1 mm fraction
                if (this.settings.add2_1mm) {
                    gramsResults['2-1'] = hydrometerSample > 0 ? (percentages['2-1'] * hydrometerSample) / (100 - coarseSum) : 0;
                } else {
                    gramsResults['2-1'] = (percentages['2-1'] * totalWeight) / 100;
                }

                // Fine fractions (>= 0.1 mm)
                fineFractions.forEach(fraction => {
                    if (fraction !== '2-1') {
                        gramsResults[fraction] = hydrometerSample > 0 ? (percentages[fraction] * hydrometerSample) / (100 - coarseSum) : 0;
                    }
                });

                // Round grams results
                const rounding = this.settings.rounding;
                const roundedGrams = {};
                Object.keys(gramsResults).forEach(key => {
                    roundedGrams[key] = Number(gramsResults[key].toFixed(rounding));
                });

                // Update grams table
                calcDiv.querySelectorAll(".grams-table td").forEach(td => {
                    const fraction = td.className.replace('grams-', '');
                    td.textContent = roundedGrams[fraction] !== undefined && !isNaN(roundedGrams[fraction])
                        ? roundedGrams[fraction]
                        : "-";
                });

                // Calculate hydrometer readings (effective)
                const hydrometerResults = {};
                // Cumulative hidden percentages for <0.05 mm, <0.01 mm, <0.002 mm
                hydrometerResults['11h'] = percentages['under-0_002'];
                hydrometerResults['30min'] = percentages['0_01-0_002'] + hydrometerResults['11h'];
                hydrometerResults['1min'] = percentages['0_05-0_01'] + hydrometerResults['30min'];

                // Convert to hydrometer readings (g/L, effective)
                const hydrometerReadings = {};
                if (particleDensity > 1 && hydrometerSample > 0) {
                    hydrometerReadings['1min'] = (hydrometerResults['1min'] * (particleDensity - 1) * hydrometerSample) / (particleDensity * (100 - coarseSum));
                    hydrometerReadings['30min'] = (hydrometerResults['30min'] * (particleDensity - 1) * hydrometerSample) / (particleDensity * (100 - coarseSum));
                    hydrometerReadings['11h'] = (hydrometerResults['11h'] * (particleDensity - 1) * hydrometerSample) / (particleDensity * (100 - coarseSum));
                } else {
                    hydrometerReadings['1min'] = 0;
                    hydrometerReadings['30min'] = 0;
                    hydrometerReadings['11h'] = 0;
                }

                // Apply corrections to get raw readings
                const rawHydrometer = {};
                rawHydrometer['1min'] = hydrometerReadings['1min'] - correction1min;
                rawHydrometer['30min'] = hydrometerReadings['30min'] - correction30min;
                rawHydrometer['11h'] = hydrometerReadings['11h'] - correction11h;

                // Round raw hydrometer readings
                const roundedHydrometer = {};
                Object.keys(rawHydrometer).forEach(key => {
                    roundedHydrometer[key] = Number(rawHydrometer[key].toFixed(rounding));
                });

                // Update hydrometer table
                calcDiv.querySelectorAll(".hydrometer-table td").forEach(td => {
                    const time = td.className.replace('hydrometer-', '');
                    td.textContent = roundedHydrometer[time] !== undefined && !isNaN(roundedHydrometer[time])
                        ? roundedHydrometer[time]
                        : "-";
                });

                this.showNotification("Расчёт выполнен успешно!", "success");
            },

            clear() {
                const calcDiv = document.querySelector(".calculation-container");
                calcDiv.querySelectorAll("input").forEach(input => {
                    if (!input.classList.contains('default')) {
                        input.value = "";
                    } else {
                        input.value = input.id === 'hydrometer-sample' ? '30' : '2.7';
                    }
                });
                calcDiv.querySelectorAll(".grams-table td, .hydrometer-table td").forEach(td => {
                    td.textContent = "-";
                });
                this.showNotification("Поля очищены", "success");
            }
        };

        App.init();
    </script>
</body>
</html>