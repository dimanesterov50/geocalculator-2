<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–µ—Ä–∑–ª—ã–π –≥—Ä—É–Ω—Ç</title>
    <style>
        * { box-sizing: border-box; }
        html, body { width: 100%; max-width: 100%; overflow-x: hidden; }
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #ffffff;
            padding: 20px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="150" height="150"><g fill="none" stroke="%23002f4b" stroke-opacity="0.05" stroke-width="1"><path d="M75 15 A60 60 0 0 1 135 75 A60 60 0 0 1 75 135 A60 60 0 0 1 15 75 A60 60 0 0 1 75 15 Z" stroke-dasharray="5 5"/><circle cx="75" cy="75" r="5"/><circle cx="105" cy="45" r="3"/><circle cx="45" cy="105" r="3"/><circle cx="105" cy="105" r="3"/><circle cx="45" cy="45" r="3"/></g></svg>');
            background-repeat: repeat;
            background-size: 150px;
        }

        .top-menu { position: fixed; top: 10px; right: 10px; display: flex; gap: 10px; z-index: 10; }
        .top-menu button { padding: 12px 16px; border-radius: 12px; border: 2px solid #2c3e50; background-color: #2c3e50; color: white; cursor: pointer; font-size: 16px; font-weight: bold; transition: background-color 0.3s; }
        .top-menu button:hover { background-color: #34495e; }

        .header-text { max-width: 800px; margin: 0 auto 30px; text-align: center; position: relative; z-index: 1; }
        .header-text h1 { font-size: 24px; color: #2c3e50; }
        .header-text p { font-size: 16px; color: #000000; }

        .method-buttons { display: flex; justify-content: center; gap: 10px; margin-top: 25px; flex-wrap: wrap; }

        .action-btn { padding: 10px 20px; border-radius: 14px; border: 2px solid #2c3e50; background-color: #2c3e50; color: white; cursor: pointer; font-size: 16px; font-weight: bold; transition: background-color 0.3s, border-color 0.3s; min-width: 300px; }
        .action-btn:hover { background-color: #34495e; border-color: #34495e; }
        .action-btn.initial { background-color: #2c3e50; border-color: #2c3e50; }
        .action-btn.initial:hover { background-color: #34495e; border-color: #34495e; }
        .action-btn.method-btn:not(.active):not(.initial) { background-color: #7f8c8d; border-color: #7f8c8d; }
        .action-btn.method-btn:not(.active):not(.initial):hover { background-color: #95a5a6; border-color: #95a5a6; }
        .action-btn.active, .action-btn.always-active { background-color: #2c3e50; border-color: #2c3e50; }
        .action-btn.active:hover, .action-btn.always-active:hover { background-color: #34495e; border-color: #34495e; }
        .btn-manual-toggle { padding: 8px 14px; border-radius: 12px; border: 2px solid #f5c07a; background-color: #f5c07a; color: white; cursor: pointer; font-size: 14px; font-weight: bold; }
        .btn-manual-toggle:hover { background-color: #e6b580; border-color: #e6b580; }

        .test-container { display: none; margin-top: 20px; }
        .test-container.active { display: block; }

        .tests-container { display: flex; flex-direction: column; align-items: center; gap: 20px; }

        .test-flex { display: flex; align-items: flex-start; justify-content: center; gap: 15px; opacity: 0; transform: translateY(20px); animation: slideIn 0.5s ease forwards; width: 100%; max-width: 900px; margin: 0 auto; position: relative; }

        .calc-wrapper { display: flex; align-items: flex-start; justify-content: center; width: 100%; max-width: 620px; margin: 0 auto; }

        .calculation-container { border: 2px solid #2c3e50; border-radius: 12px; padding: 15px; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); background-color: rgba(255, 255, 255, 0.9); min-width: 500px; max-width: 620px; margin: 0 auto; display: block; box-sizing: border-box; }

        .sample-block { border: 1px dashed #2c3e50; border-radius: 12px; padding: 8px; margin-bottom: 10px; background-color: rgba(240, 248, 255, 0.5); display: flex; align-items: center; justify-content: space-between; opacity: 0; transform: translateY(10px); animation: slideIn 0.4s ease forwards; overflow-x: auto; position: relative; }
        .sample-block:nth-child(1) { animation-delay: 0s; }
        .sample-block:nth-child(2) { animation-delay: 0.15s; }
        .sample-block:nth-child(3) { animation-delay: 0.3s; }
        .sample-block:nth-child(4) { animation-delay: 0.45s; }

        .sample-content { flex-grow: 1; }
        .sample-row { display: flex; flex-direction: column; gap: 8px; }
        .sample-row input, .sample-row select { width: 100%; padding: 6px; border-radius: 6px; border: 1px solid #ccc; font-size: 13px; }
        .extra-row { display: flex; flex-direction: column; gap: 8px; margin-top: 10px; }
        .extra-row input, .extra-row select { width: 100%; padding: 6px; border-radius: 6px; border: 1px solid #ccc; font-size: 13px; }
        .extra-row label { font-size: 14px; color: #2c3e50; font-weight: bold; margin-bottom: 4px; }

        .sample-result { font-size: 12px; color: #7f8c8d; margin-left: 8px; min-width: 50px; text-align: right; }

        .action-row { display: flex; justify-content: space-between; align-items: center; margin-top: 8px; }

        .btn-calc-green { padding: 8px 14px; border-radius: 12px; border: 2px solid #2e7d32; background-color: #2e7d32; color: white; cursor: pointer; font-size: 14px; font-weight: bold; }
        .btn-calc-green:hover { background-color: #388e3c; }

        .btn-clear { padding: 8px 14px; border-radius: 12px; border: 1px solid #7f8c8d; background-color: #ecf0f1; color: #2c3e50; cursor: pointer; font-size: 14px; }
        .btn-clear:hover { background-color: #bdc3c7; }

        .btn-continue { padding: 8px 14px; border-radius: 12px; border: 2px solid #3498db; background-color: #3498db; color: white; cursor: pointer; font-size: 14px; font-weight: bold; }
        .btn-continue:hover { background-color: #2980b9; }

        .average-container { display: flex; flex-direction: column; justify-content: flex-start; align-items: stretch; margin-top: 10px; padding: 8px; background-color: rgba(240, 248, 255, 0.5); }
        .average-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .average-label { font-size: 16px; color: #2c3e50; font-weight: bold; text-align: left; flex-grow: 1; }
        .result-average { font-weight: bold; font-size: 16px; color: #1a73e8; text-align: right; flex-grow: 0; width: 100px; }

        .btn-delete-sample { position: absolute; top: 4px; right: 4px; padding: 2px 8px; border-radius: 10px; border: 1px solid #e74c3c; background-color: #e74c3c; color: white; cursor: pointer; font-size: 14px; font-weight: bold; }
        .btn-delete-sample:hover { background-color: #c0392b; }

        .delete-btn { padding: 6px 12px; border-radius: 10px; border: 1px solid #e74c3c; background-color: #e74c3c; color: white; cursor: pointer; font-size: 14px; font-weight: bold; position: absolute; top: 0; right: 0; }
        .delete-btn:hover { background-color: #c0392b; }

        @keyframes slideIn { to { opacity: 1; transform: translateY(0); } }

        @media screen and (max-width: 768px) {
            body { padding-top: 60px; }
            .header-text { margin-top: 20px; }
            .method-buttons { flex-direction: column; align-items: center; }
            .action-btn { width: 90%; max-width: 300px; }
            .test-flex { flex-direction: column; align-items: center; }
            .calc-wrapper { flex-direction: column; align-items: center; width: 100%; max-width: 600px; margin: 0 auto; }
            .calculation-container { width: 100%; max-width: 90%; min-width: 320px; margin: 0 auto; box-sizing: border-box; }
            .delete-btn { position: static; margin-top: 10px; align-self: flex-end; }
            .sample-row, .extra-row { flex-direction: column; }
            .sample-row input, .sample-row select, .extra-row input, .extra-row select { width: 100%; }
            .extra-row { margin-top: 15px; }
            .average-container { width: 100%; }
            .average-row { flex-direction: column; align-items: flex-start; }
            .average-label { margin-bottom: 2px; }
            .result-average { margin-left: 0; width: auto; text-align: right; }
            .btn-delete-sample { top: 4px; right: 4px; }
        }

        @media screen and (max-width: 400px) {
            .calculation-container { min-width: 280px; max-width: 90%; }
        }
    </style>
</head>
<body>
    <div class="top-menu">
        <button onclick="App.navigate('index.html')" aria-label="–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é">üè†</button>
    </div>

    <div class="header-text">
        <h1>–ú–µ—Ä–∑–ª—ã–π –≥—Ä—É–Ω—Ç</h1>
        <p>–í—ã–±–µ—Ä–∏—Ç–µ –≤–∫–ª–∞–¥–∫—É –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –º–µ—Ä–∑–ª–æ–≥–æ –≥—Ä—É–Ω—Ç–∞ –∏ –≤–≤–µ–¥–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ.</p>
    </div>

    <div class="method-buttons">
        <button class="action-btn method-btn initial" id="btn-moisture" onclick="App.toggleMethod('moisture')" aria-label="–†–∞—Å—á—ë—Ç –≤–ª–∞–∂–Ω–æ—Å—Ç–∏">–í–ª–∞–∂–Ω–æ—Å—Ç—å</button>
        <button class="action-btn method-btn initial" id="btn-ice" onclick="App.toggleMethod('ice')" aria-label="–†–∞—Å—á—ë—Ç –ª—å–¥–∏—Å—Ç–æ—Å—Ç–∏">–õ—å–¥–∏—Å—Ç–æ—Å—Ç—å</button>
        <button class="action-btn method-btn initial" id="btn-thermophysics" onclick="App.toggleMethod('thermophysics')" aria-label="–†–∞—Å—á—ë—Ç —Ç–µ–ø–ª–æ—Ñ–∏–∑–∏–∫–∏">–¢–µ–ø–ª–æ—Ñ–∏–∑–∏–∫–∞</button>
    </div>

    <div id="test-container-moisture" class="test-container">
        <p style="text-align: center; font-size: 16px; color: #000000;">–ü–æ—Å–ª–µ —Ä–∞—Å—á—ë—Ç–∞ —Å—É–º–º–∞—Ä–Ω–æ–π –≤–ª–∞–∂–Ω–æ—Å—Ç–∏ (Wtot) –≤—ã —Å–º–æ–∂–µ—Ç–µ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: –≤–ª–∞–∂–Ω–æ—Å—Ç—å –º–µ–∂–¥—É –º–∏–Ω–µ—Ä–∞–ª—å–Ω—ã–º–∏ –ø—Ä–æ—Å–ª–æ–π–∫–∞–º–∏ (Wm), –≤–ª–∞–∂–Ω–æ—Å—Ç—å –ª—å–¥–∞ (Wi), –≤–ª–∞–∂–Ω–æ—Å—Ç—å –Ω–µ–∑–∞–º–µ—Ä–∑—à–µ–π –≤–æ–¥—ã (Ww) –∏ –≤–ª–∞–∂–Ω–æ—Å—Ç—å –ø–æ—Ä–æ–≤–æ–≥–æ –ª—å–¥–∞ (Wic).</p>
        <div class="tests-container" id="tests-container-moisture"></div>
        <div style="text-align: center; margin-top: 25px;">
            <button class="action-btn always-active" onclick="App.addTest('moisture')" aria-label="–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –∏—Å–ø—ã—Ç–∞–Ω–∏–µ">+ –î–æ–±–∞–≤–∏—Ç—å –∏—Å–ø—ã—Ç–∞–Ω–∏–µ</button>
        </div>
    </div>

    <div id="test-container-ice" class="test-container">
        <div class="tests-container" id="tests-container-ice"></div>
        <div style="text-align: center; margin-top: 25px;">
            <button class="action-btn always-active" onclick="App.addTest('ice')" aria-label="–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –∏—Å–ø—ã—Ç–∞–Ω–∏–µ">+ –î–æ–±–∞–≤–∏—Ç—å –∏—Å–ø—ã—Ç–∞–Ω–∏–µ</button>
        </div>
    </div>

    <div id="test-container-thermophysics" class="test-container">
        <div class="tests-container" id="tests-container-thermophysics"></div>
        <div style="text-align: center; margin-top: 25px;">
            <button class="action-btn always-active" onclick="App.addTest('thermophysics')" aria-label="–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –∏—Å–ø—ã—Ç–∞–Ω–∏–µ">+ –î–æ–±–∞–≤–∏—Ç—å –∏—Å–ø—ã—Ç–∞–Ω–∏–µ</button>
        </div>
    </div>

    <script>
        const App = {
            // Thermal conductivity data
            sandThermalData: [
                { pd: 0.1, W: 9.00, Œªth: 0.30, Œªf: 0.40 },
                { pd: 0.1, W: 6.00, Œªth: 0.35, Œªf: 0.45 },
                { pd: 0.1, W: 4.00, Œªth: 0.40, Œªf: 0.50 },
                { pd: 0.1, W: 2.00, Œªth: 0.50, Œªf: 0.60 },
                { pd: 0.2, W: 4.00, Œªth: 0.45, Œªf: 0.55 },
                { pd: 0.2, W: 2.00, Œªth: 0.55, Œªf: 0.65 },
                { pd: 0.3, W: 3.00, Œªth: 0.50, Œªf: 0.60 },
                { pd: 0.3, W: 2.00, Œªth: 0.60, Œªf: 0.70 },
                { pd: 0.4, W: 2.00, Œªth: 0.65, Œªf: 0.75 },
                { pd: 0.7, W: 1.00, Œªth: 0.80, Œªf: 0.90 },
                { pd: 1.0, W: 0.60, Œªth: 0.95, Œªf: 1.05 },
                { pd: 1.2, W: 0.40, Œªth: 1.10, Œªf: 1.20 },
                { pd: 1.4, W: 0.35, Œªth: 1.20, Œªf: 1.30 },
                { pd: 1.4, W: 0.30, Œªth: 1.30, Œªf: 1.40 },
                { pd: 1.4, W: 0.25, Œªth: 1.91, Œªf: 2.14 },
                { pd: 1.4, W: 0.20, Œªth: 1.57, Œªf: 1.86 },
                { pd: 1.4, W: 0.15, Œªth: 1.39, Œªf: 1.62 },
                { pd: 1.4, W: 0.10, Œªth: 1.10, Œªf: 1.27 },
                { pd: 1.4, W: 0.05, Œªth: 0.75, Œªf: 0.81 },
                { pd: 1.6, W: 0.30, Œªth: 2.00, Œªf: 2.20 },
                { pd: 1.6, W: 0.25, Œªth: 2.50, Œªf: 2.73 },
                { pd: 1.6, W: 0.20, Œªth: 2.15, Œªf: 2.37 },
                { pd: 1.6, W: 0.15, Œªth: 1.80, Œªf: 2.00 },
                { pd: 1.6, W: 0.10, Œªth: 1.45, Œªf: 1.62 },
                { pd: 1.6, W: 0.05, Œªth: 1.05, Œªf: 1.10 },
                { pd: 1.8, W: 0.20, Œªth: 2.67, Œªf: 2.84 },
                { pd: 1.8, W: 0.15, Œªth: 2.26, Œªf: 2.62 },
                { pd: 1.8, W: 0.10, Œªth: 1.97, Œªf: 2.20 },
                { pd: 1.8, W: 0.05, Œªth: 1.45, Œªf: 1.51 },
                { pd: 2.0, W: 0.10, Œªth: 2.73, Œªf: 2.90 },
                { pd: 2.0, W: 0.05, Œªth: 2.10, Œªf: 2.14 }
            ],
            loamySandThermalData: [
                { pd: 0.1, W: 9.00, Œªth: 0.25, Œªf: 0.35 },
                { pd: 0.1, W: 6.00, Œªth: 0.30, Œªf: 0.40 },
                { pd: 0.1, W: 4.00, Œªth: 0.35, Œªf: 0.45 },
                { pd: 0.1, W: 2.00, Œªth: 0.40, Œªf: 0.50 },
                { pd: 0.2, W: 4.00, Œªth: 0.40, Œªf: 0.50 },
                { pd: 0.2, W: 2.00, Œªth: 0.45, Œªf: 0.55 },
                { pd: 0.3, W: 3.00, Œªth: 0.45, Œªf: 0.55 },
                { pd: 0.3, W: 2.00, Œªth: 0.50, Œªf: 0.60 },
                { pd: 0.4, W: 2.00, Œªth: 0.55, Œªf: 2.10 },
                { pd: 0.7, W: 1.00, Œªth: 0.70, Œªf: 2.10 },
                { pd: 1.0, W: 0.60, Œªth: 0.85, Œªf: 2.00 },
                { pd: 1.2, W: 0.40, Œªth: 1.00, Œªf: 1.90 },
                { pd: 1.4, W: 0.35, Œªth: 1.80, Œªf: 1.86 },
                { pd: 1.4, W: 0.30, Œªth: 1.74, Œªf: 1.80 },
                { pd: 1.4, W: 0.25, Œªth: 1.57, Œªf: 1.68 },
                { pd: 1.4, W: 0.20, Œªth: 1.33, Œªf: 1.51 },
                { pd: 1.4, W: 0.15, Œªth: 1.10, Œªf: 1.27 },
                { pd: 1.4, W: 0.10, Œªth: 0.93, Œªf: 1.05 },
                { pd: 1.4, W: 0.05, Œªth: 0.64, Œªf: 0.70 },
                { pd: 1.6, W: 0.30, Œªth: 1.86, Œªf: 1.97 },
                { pd: 1.6, W: 0.25, Œªth: 1.80, Œªf: 1.91 },
                { pd: 1.6, W: 0.20, Œªth: 1.62, Œªf: 1.74 },
                { pd: 1.6, W: 0.15, Œªth: 1.45, Œªf: 1.57 },
                { pd: 1.6, W: 0.10, Œªth: 1.28, Œªf: 1.28 },
                { pd: 1.6, W: 0.05, Œªth: 0.81, Œªf: 0.87 },
                { pd: 1.8, W: 0.20, Œªth: 1.86, Œªf: 1.97 },
                { pd: 1.8, W: 0.15, Œªth: 1.68, Œªf: 1.80 },
                { pd: 1.8, W: 0.10, Œªth: 1.45, Œªf: 1.57 },
                { pd: 1.8, W: 0.05, Œªth: 0.99, Œªf: 0.99 },
                { pd: 2.0, W: 0.10, Œªth: 1.74, Œªf: 1.86 },
                { pd: 2.0, W: 0.05, Œªth: 1.00, Œªf: 1.10 }
            ],
            loamClayThermalData: [
                { pd: 0.1, W: 9.00, Œªth: 0.20, Œªf: 0.30 },
                { pd: 0.1, W: 6.00, Œªth: 0.25, Œªf: 0.35 },
                { pd: 0.1, W: 4.00, Œªth: 0.30, Œªf: 0.40 },
                { pd: 0.1, W: 2.00, Œªth: 0.35, Œªf: 0.45 },
                { pd: 0.2, W: 4.00, Œªth: 0.35, Œªf: 0.45 },
                { pd: 0.2, W: 2.00, Œªth: 0.40, Œªf: 0.50 },
                { pd: 0.3, W: 3.00, Œªth: 0.40, Œªf: 0.50 },
                { pd: 0.3, W: 2.00, Œªth: 0.45, Œªf: 0.55 },
                { pd: 0.4, W: 2.00, Œªth: 0.50, Œªf: 2.10 },
                { pd: 0.7, W: 1.00, Œªth: 0.65, Œªf: 2.10 },
                { pd: 1.0, W: 0.60, Œªth: 0.80, Œªf: 1.90 },
                { pd: 1.2, W: 0.40, Œªth: 1.57, Œªf: 1.80 },
                { pd: 1.4, W: 0.35, Œªth: 1.57, Œªf: 1.66 },
                { pd: 1.4, W: 0.30, Œªth: 1.45, Œªf: 1.57 },
                { pd: 1.4, W: 0.25, Œªth: 1.33, Œªf: 1.51 },
                { pd: 1.4, W: 0.20, Œªth: 1.10, Œªf: 1.22 },
                { pd: 1.4, W: 0.15, Œªth: 0.87, Œªf: 0.99 },
                { pd: 1.4, W: 0.10, Œªth: 0.70, Œªf: 0.75 },
                { pd: 1.4, W: 0.05, Œªth: 0.46, Œªf: 0.52 },
                { pd: 1.6, W: 0.30, Œªth: 1.68, Œªf: 1.86 },
                { pd: 1.6, W: 0.25, Œªth: 1.51, Œªf: 1.68 },
                { pd: 1.6, W: 0.20, Œªth: 1.33, Œªf: 1.51 },
                { pd: 1.6, W: 0.15, Œªth: 1.10, Œªf: 1.22 },
                { pd: 1.6, W: 0.10, Œªth: 0.87, Œªf: 0.93 },
                { pd: 1.6, W: 0.05, Œªth: 0.58, Œªf: 0.64 },
                { pd: 1.8, W: 0.20, Œªth: 1.57, Œªf: 1.80 },
                { pd: 1.8, W: 0.15, Œªth: 1.39, Œªf: 1.57 },
                { pd: 1.8, W: 0.10, Œªth: 1.05, Œªf: 1.22 },
                { pd: 1.8, W: 0.05, Œªth: 0.70, Œªf: 0.75 },
                { pd: 2.0, W: 0.10, Œªth: 1.28, Œªf: 1.39 },
                { pd: 2.0, W: 0.05, Œªth: 0.80, Œªf: 0.85 }
            ],
            heatCapacityData: [
                { pd: 0.1, W: 9.00, Cth: 4.00, Cf: 2.31 },
                { pd: 0.1, W: 6.00, Cth: 2.73, Cf: 1.65 },
                { pd: 0.1, W: 4.00, Cth: 1.88, Cf: 1.26 },
                { pd: 0.1, W: 2.00, Cth: 1.05, Cf: 0.64 },
                { pd: 0.2, W: 4.00, Cth: 3.78, Cf: 2.40 },
                { pd: 0.2, W: 2.00, Cth: 2.10, Cf: 1.47 },
                { pd: 0.3, W: 3.00, Cth: 4.15, Cf: 2.40 },
                { pd: 0.3, W: 2.00, Cth: 3.32, Cf: 2.10 },
                { pd: 0.4, W: 2.00, Cth: 3.78, Cf: 2.73 },
                { pd: 0.7, W: 1.00, Cth: 3.60, Cf: 2.10 },
                { pd: 1.0, W: 0.60, Cth: 3.44, Cf: 2.18 },
                { pd: 1.2, W: 0.40, Cth: 3.11, Cf: 2.12 },
                { pd: 1.4, W: 0.35, Cth: 3.35, Cf: 2.35 },
                { pd: 1.4, W: 0.30, Cth: 3.02, Cf: 2.18 },
                { pd: 1.4, W: 0.25, Cth: 2.78, Cf: 2.06 },
                { pd: 1.4, W: 0.20, Cth: 2.48, Cf: 1.89 },
                { pd: 1.4, W: 0.15, Cth: 2.18, Cf: 1.76 },
                { pd: 1.4, W: 0.10, Cth: 1.89, Cf: 1.74 },
                { pd: 1.4, W: 0.05, Cth: 1.60, Cf: 1.47 },
                { pd: 1.6, W: 0.30, Cth: 1.84, Cf: 2.48 },
                { pd: 1.6, W: 0.25, Cth: 3.15, Cf: 2.35 },
                { pd: 1.6, W: 0.20, Cth: 2.31, Cf: 2.14 },
                { pd: 1.6, W: 0.15, Cth: 2.48, Cf: 2.02 },
                { pd: 1.6, W: 0.10, Cth: 2.16, Cf: 1.80 },
                { pd: 1.6, W: 0.05, Cth: 1.83, Cf: 1.68 },
                { pd: 1.8, W: 0.20, Cth: 3.17, Cf: 2.41 },
                { pd: 1.8, W: 0.15, Cth: 2.78, Cf: 2.26 },
                { pd: 1.8, W: 0.10, Cth: 2.42, Cf: 2.04 },
                { pd: 1.8, W: 0.05, Cth: 2.04, Cf: 1.89 },
                { pd: 2.0, W: 0.10, Cth: 2.68, Cf: 2.26 },
                { pd: 2.0, W: 0.05, Cth: 2.26, Cf: 2.10 }
            ],

            init() {
                document.addEventListener('DOMContentLoaded', () => {
                    console.log('Frozen soil page loaded');
                });
            },

            toggleMenu() {
                document.getElementById("sidebar").classList.toggle("open");
            },

            navigate(url) {
                location.href = url;
            },

            focusNextInput(event, input) {
                if (event.key === "Enter") {
                    event.preventDefault();
                    const calcDiv = input.closest(".calculation-container");
                    const method = calcDiv.querySelector(".btn-calc-green").getAttribute("onclick").match(/'([^']+)'/)[1];
                    const allInputs = Array.from(calcDiv.querySelectorAll(".sample-row input, .sample-row select, .extra-row input, .extra-row select"));
                    const currentIndex = allInputs.indexOf(input);
                    if (currentIndex === allInputs.length - 1) {
                        this.calculateTest(calcDiv.querySelector(".btn-calc-green"), method);
                    } else {
                        allInputs[currentIndex + 1].focus();
                    }
                }
            },

            toggleMethod(method) {
                const buttons = ['moisture', 'ice', 'thermophysics'].map(id => document.getElementById(`btn-${id}`));
                buttons.forEach(btn => btn.classList.remove('initial'));
                const containers = ['moisture', 'ice', 'thermophysics'].map(id => document.getElementById(`test-container-${id}`));
                containers.forEach(container => container.classList.remove('active'));
                document.getElementById(`test-container-${method}`).classList.add('active');
                buttons.forEach(btn => btn.classList.remove('active'));
                document.getElementById(`btn-${method}`).classList.add('active');
                if (!document.getElementById(`tests-container-${method}`).querySelector('.test-flex')) {
                    this.addTest(method);
                }
            },

            addTest(method) {
                const container = document.getElementById(`tests-container-${method}`);
                const testFlex = document.createElement("div");
                testFlex.classList.add("test-flex");

                const calcWrapper = document.createElement("div");
                calcWrapper.classList.add("calc-wrapper");

                const calcDiv = document.createElement("div");
                calcDiv.classList.add("calculation-container");

                let sampleContent;
                if (method === 'moisture') {
                    sampleContent = `
                        <div class="sample-block" id="initial-moisture-block">
                            <div class="sample-content">
                                <div class="sample-row">
                                    <input type="number" class="box-weight" placeholder="–í–µ—Å –±—é–∫—Å–∞, –≥" aria-label="–í–µ—Å –±—é–∫—Å–∞" onkeypress="App.focusNextInput(event, this)">
                                    <input type="number" class="wet-weight" placeholder="–í–µ—Å –±—é–∫—Å–∞ —Å –≤–ª–∞–∂–Ω—ã–º –≥—Ä—É–Ω—Ç–æ–º, –≥" aria-label="–í–µ—Å –±—é–∫—Å–∞ —Å –≤–ª–∞–∂–Ω—ã–º –≥—Ä—É–Ω—Ç–æ–º" onkeypress="App.focusNextInput(event, this)">
                                    <input type="number" class="dry-weight" placeholder="–í–µ—Å –±—é–∫—Å–∞ —Å —Å—É—Ö–∏–º –≥—Ä—É–Ω—Ç–æ–º, –≥" aria-label="–í–µ—Å –±—é–∫—Å–∞ —Å —Å—É—Ö–∏–º –≥—Ä—É–Ω—Ç–æ–º" onkeypress="App.focusNextInput(event, this)">
                                </div>
                            </div>
                            <div class="sample-result" id="result-moisture">-</div>
                        </div>
                        <div class="average-container" id="wtot-container">
                            <span class="average-label">–°—É–º–º–∞—Ä–Ω–∞—è –≤–ª–∞–∂–Ω–æ—Å—Ç—å (Wtot):</span>
                            <div class="result-average"><span class="density-value" id="wtot-value">-</span> –¥.–µ.</div>
                        </div>
                        <div class="action-row">
                            <div>
                                <button class="btn-calc-green" onclick="App.calculateTest(this, 'moisture')" aria-label="–†–∞—Å—Å—á–∏—Ç–∞—Ç—å">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
                                <button class="btn-clear" onclick="App.clearTest(this)" aria-label="–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª—è">–û—á–∏—Å—Ç–∏—Ç—å</button>
                                <button class="btn-continue" id="btn-continue-moisture" onclick="App.continueCalculation('moisture', 1)" aria-label="–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–∞—Å—á—ë—Ç" style="display: none;">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
                            </div>
                            <button class="btn-manual-toggle" id="manual-toggle-moisture" onclick="App.toggleManualInput('moisture')" aria-label="–í–≤–µ—Å—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏–µ —Å—É–º–º–∞—Ä–Ω–æ–π –≤–ª–∞–∂–Ω–æ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é">–í–≤–µ—Å—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏–µ —Å—É–º–º–∞—Ä–Ω–æ–π –≤–ª–∞–∂–Ω–æ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é</button>
                        </div>
                        <div class="extra-row" id="manual-wtot-row" style="display: none; margin-top: 10px;">
                            <label>–í–≤–µ—Å—Ç–∏ Wtot –≤—Ä—É—á–Ω—É—é:</label>
                            <input type="number" class="manual-wtot" placeholder="–°—É–º–º–∞—Ä–Ω–∞—è –≤–ª–∞–∂–Ω–æ—Å—Ç—å (Wtot), –¥.–µ." aria-label="–°—É–º–º–∞—Ä–Ω–∞—è –≤–ª–∞–∂–Ω–æ—Å—Ç—å –≤—Ä—É—á–Ω—É—é" onkeypress="App.focusNextInput(event, this)">
                            <button class="btn-calc-green" onclick="App.useManualWtot(this)" aria-label="–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é –≤–≤–µ–¥—ë–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å</button>
                        </div>
                        <div id="extra-result-moisture" style="display: none; margin-top: 10px;">
                            <p>–†–∞—Å—á–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:</p>
                            <div class="extra-row">
                                <label>–í–ª–∞–∂–Ω–æ—Å—Ç—å –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ —Ä–∞—Å–∫–∞—Ç—ã–≤–∞–Ω–∏—è, –¥.–µ.:</label>
                                <input type="number" class="wp" placeholder="–í–ª–∞–∂–Ω–æ—Å—Ç—å –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ —Ä–∞—Å–∫–∞—Ç—ã–≤–∞–Ω–∏—è (Wp), –¥.–µ." aria-label="–í–ª–∞–∂–Ω–æ—Å—Ç—å –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ —Ä–∞—Å–∫–∞—Ç—ã–≤–∞–Ω–∏—è" onkeypress="App.focusNextInput(event, this)">
                                <label>–¢–∏–ø –≥—Ä—É–Ω—Ç–∞:</label>
                                <select class="soil-type" aria-label="–¢–∏–ø –≥—Ä—É–Ω—Ç–∞" onchange="App.toggleConsistency(this)">
                                    <option value="sand">–ü–µ—Å–æ–∫</option>
                                    <option value="loamy_sand">–°—É–ø–µ—Å—å</option>
                                    <option value="light_loam">–°—É–≥–ª–∏–Ω–æ–∫ –ª–µ–≥–∫–∏–π</option>
                                    <option value="heavy_loam">–°—É–≥–ª–∏–Ω–æ–∫ —Ç—è–∂–µ–ª—ã–π</option>
                                    <option value="clay">–ì–ª–∏–Ω–∞</option>
                                </select>
                                <label>–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ü–∏—è:</label>
                                <select class="consistency" aria-label="–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ü–∏—è">
                                    <option value="hard">–¢–≤–µ—Ä–¥–∞—è</option>
                                    <option value="semi_hard">–ü–æ–ª—É—Ç–≤–µ—Ä–¥–∞—è</option>
                                    <option value="tough_plastic">–¢—É–≥–æ–ø–ª–∞—Å—Ç–∏—á–Ω–∞—è</option>
                                    <option value="soft_plastic">–ú—è–≥–∫–æ–ø–ª–∞—Å—Ç–∏—á–Ω–∞—è</option>
                                    <option value="flowing_plastic">–¢–µ–∫—É—á–µ–ø–ª–∞—Å—Ç–∏—á–Ω–∞—è</option>
                                    <option value="flowing">–¢–µ–∫—É—á–∞—è</option>
                                </select>
                            </div>
                            <button class="btn-calc-green" id="calc-extra-moisture" onclick="App.calculateExtra('moisture')" aria-label="–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –¥–æ–ø. –ø–∞—Ä–∞–º–µ—Ç—Ä—ã" style="display: none; margin-top: 10px;">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –¥–æ–ø. –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</button>
                            <p>–í–ª–∞–∂–Ω–æ—Å—Ç—å –º–µ–∂–¥—É –ø—Ä–æ—Å–ª–æ–π–∫–∞–º–∏ (Wm): <span id="wm-value">-</span> –¥.–µ.</p>
                            <p>–í–ª–∞–∂–Ω–æ—Å—Ç—å –ª—å–¥–∞ (Wi): <span id="wi-value">-</span> –¥.–µ.</p>
                            <p>–í–ª–∞–∂–Ω–æ—Å—Ç—å –Ω–µ–∑–∞–º–µ—Ä–∑—à–µ–π –≤–æ–¥—ã (Ww): <span id="ww-value">-</span> –¥.–µ.</p>
                            <p>–í–ª–∞–∂–Ω–æ—Å—Ç—å –ø–æ—Ä–æ–≤–æ–≥–æ –ª—å–¥–∞ (Wic): <span id="wic-value">-</span> –¥.–µ.</p>
                        </div>
                    `;
                } else if (method === 'ice') {
                    sampleContent = `
                        <div class="sample-block">
                            <div class="sample-content">
                                <div class="sample-row">
                                    <input type="number" class="wtot" placeholder="–°—É–º–º–∞—Ä–Ω–∞—è –≤–ª–∞–∂–Ω–æ—Å—Ç—å (Wtot), –¥.–µ." aria-label="–°—É–º–º–∞—Ä–Ω–∞—è –≤–ª–∞–∂–Ω–æ—Å—Ç—å" onkeypress="App.focusNextInput(event, this)">
                                    <input type="number" class="wm" placeholder="–í–ª–∞–∂–Ω–æ—Å—Ç—å –º–µ–∂–¥—É –ø—Ä–æ—Å–ª–æ–π–∫–∞–º–∏ (Wm), –¥.–µ." aria-label="–í–ª–∞–∂–Ω–æ—Å—Ç—å –º–µ–∂–¥—É –ø—Ä–æ—Å–ª–æ–π–∫–∞–º–∏" onkeypress="App.focusNextInput(event, this)">
                                    <input type="number" class="ww" placeholder="–í–ª–∞–∂–Ω–æ—Å—Ç—å –∑–∞ —Å—á—ë—Ç –Ω–µ–∑–∞–º–µ—Ä–∑—à–µ–π –≤–æ–¥—ã (Ww), –¥.–µ." aria-label="–í–ª–∞–∂–Ω–æ—Å—Ç—å –∑–∞ —Å—á—ë—Ç –Ω–µ–∑–∞–º–µ—Ä–∑—à–µ–π –≤–æ–¥—ã" onkeypress="App.focusNextInput(event, this)">
                                    <input type="number" class="wic" placeholder="–í–ª–∞–∂–Ω–æ—Å—Ç—å –ø–æ—Ä–æ–≤–æ–≥–æ –ª—å–¥–∞ (Wic), –¥.–µ." aria-label="–í–ª–∞–∂–Ω–æ—Å—Ç—å –ø–æ—Ä–æ–≤–æ–≥–æ –ª—å–¥–∞" onkeypress="App.focusNextInput(event, this)">
                                    <input type="number" class="p" placeholder="–ü–ª–æ—Ç–Ω–æ—Å—Ç—å (p), –≥/—Å–º¬≥" aria-label="–ü–ª–æ—Ç–Ω–æ—Å—Ç—å" onkeypress="App.focusNextInput(event, this)">
                                    <input type="number" class="ps" placeholder="–ü–ª–æ—Ç–Ω–æ—Å—Ç—å —á–∞—Å—Ç–∏—Ü –≥—Ä—É–Ω—Ç–∞ (ps), –≥/—Å–º¬≥" aria-label="–ü–ª–æ—Ç–Ω–æ—Å—Ç—å —á–∞—Å—Ç–∏—Ü –≥—Ä—É–Ω—Ç–∞" onkeypress="App.focusNextInput(event, this)">
                                    <input type="number" class="e" placeholder="–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ø–æ—Ä–∏—Å—Ç–æ—Å—Ç–∏ (e), –¥.–µ." aria-label="–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ø–æ—Ä–∏—Å—Ç–æ—Å—Ç–∏" onkeypress="App.focusNextInput(event, this)">
                                </div>
                            </div>
                            <div class="sample-result" id="result-ice">-</div>
                        </div>
                        <div class="average-container">
                            <div class="average-row">
                                <span class="average-label">–õ—å–¥–∏—Å—Ç–æ—Å—Ç—å —Å—É–º–º–∞—Ä–Ω–∞—è (Itot):</span>
                                <div class="result-average"><span id="itot-value">-</span> –¥.–µ.</div>
                            </div>
                            <div class="average-row">
                                <span class="average-label">–õ—å–¥–∏—Å—Ç–æ—Å—Ç—å –º–µ–∂–ø—Ä–æ—Å–ª–æ–π–æ—á–Ω–∞—è (Ii):</span>
                                <div class="result-average"><span id="ii-value">-</span> –¥.–µ.</div>
                            </div>
                            <div class="average-row">
                                <span class="average-label">–õ—å–¥–∏—Å—Ç–æ—Å—Ç—å –ø–æ—Ä–æ–≤–∞—è (Iic):</span>
                                <div class="result-average"><span id="iic-value">-</span> –¥.–µ.</div>
                            </div>
                            <div class="average-row">
                                <span class="average-label">–°—Ç–µ–ø–µ–Ω—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ—Ä (Sr):</span>
                                <div class="result-average"><span id="sr-value">-</span> –¥.–µ.</div>
                            </div>
                        </div>
                        <div class="action-row">
                            <div>
                                <button class="btn-calc-green" onclick="App.calculateTest(this, 'ice')" aria-label="–†–∞—Å—Å—á–∏—Ç–∞—Ç—å">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
                                <button class="btn-clear" onclick="App.clearTest(this)" aria-label="–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª—è">–û—á–∏—Å—Ç–∏—Ç—å</button>
                            </div>
                        </div>
                    `;
                } else if (method === 'thermophysics') {
                    sampleContent = `
                        <div class="sample-block">
                            <div class="sample-content">
                                <div class="sample-row">
                                    <input type="number" class="pd" placeholder="–ü–ª–æ—Ç–Ω–æ—Å—Ç—å —Å—É—Ö–æ–≥–æ –≥—Ä—É–Ω—Ç–∞ (pd), –≥/—Å–º¬≥" aria-label="–ü–ª–æ—Ç–Ω–æ—Å—Ç—å —Å—É—Ö–æ–≥–æ –≥—Ä—É–Ω—Ç–∞" onkeypress="App.focusNextInput(event, this)">
                                    <input type="number" class="W" placeholder="–í–ª–∞–∂–Ω–æ—Å—Ç—å –≥—Ä—É–Ω—Ç–∞ (W), –¥.–µ." aria-label="–í–ª–∞–∂–Ω–æ—Å—Ç—å –≥—Ä—É–Ω—Ç–∞" onkeypress="App.focusNextInput(event, this)">
                                    <select class="soil-type" aria-label="–¢–∏–ø –≥—Ä—É–Ω—Ç–∞">
                                        <option value="sand">–ü–µ—Å–æ–∫</option>
                                        <option value="loamy_sand">–°—É–ø–µ—Å—å</option>
                                        <option value="loam">–°—É–≥–ª–∏–Ω–æ–∫</option>
                                        <option value="clay">–ì–ª–∏–Ω–∞</option>
                                    </select>
                                </div>
                            </div>
                            <div class="sample-result" id="result-thermophysics">-</div>
                            <button class="btn-delete-sample" onclick="App.deleteSample(this)" aria-label="–£–¥–∞–ª–∏—Ç—å –æ–±—Ä–∞–∑–µ—Ü">‚Äî</button>
                        </div>
                        <div class="average-container">
                            <div class="average-row">
                                <span class="average-label">–¢–µ–ø–ª–æ–ø—Ä–æ–≤–æ–¥–Ω–æ—Å—Ç—å —Ç–∞–ª–∞—è (Œªth):</span>
                                <div class="result-average"><span id="lth-value">-</span> –í—Ç/(–º¬∑¬∞–°)</div>
                            </div>
                            <div class="average-row">
                                <span class="average-label">–¢–µ–ø–ª–æ–ø—Ä–æ–≤–æ–¥–Ω–æ—Å—Ç—å –º–µ—Ä–∑–ª–∞—è (Œªf):</span>
                                <div class="result-average"><span id="lf-value">-</span> –í—Ç/(–º¬∑¬∞–°)</div>
                            </div>
                            <div class="average-row">
                                <span class="average-label">–£–¥–µ–ª—å–Ω–∞—è —Ç–µ–ø–ª–æ–µ–º–∫–æ—Å—Ç—å —Ç–∞–ª–∞—è (Cmth):</span>
                                <div class="result-average"><span id="cmth-value">-</span> √ó10‚Åª‚Å∂ –î–∂/(–∫–≥¬∑¬∞–°)</div>
                            </div>
                            <div class="average-row">
                                <span class="average-label">–£–¥–µ–ª—å–Ω–∞—è —Ç–µ–ø–ª–æ–µ–º–∫–æ—Å—Ç—å –º–µ—Ä–∑–ª–∞—è (Cmf):</span>
                                <div class="result-average"><span id="cmf-value">-</span> √ó10‚Åª‚Å∂ –î–∂/(–∫–≥¬∑¬∞–°)</div>
                            </div>
                            <div class="average-row">
                                <span class="average-label">–û–±—ä–µ–º–Ω–∞—è —Ç–µ–ø–ª–æ–µ–º–∫–æ—Å—Ç—å —Ç–∞–ª–∞—è (Cth):</span>
                                <div class="result-average"><span id="cth-value">-</span> √ó10‚Åª‚Å∂ –î–∂/(–∫–≥¬∑¬∞–°)</div>
                            </div>
                            <div class="average-row">
                                <span class="average-label">–û–±—ä–µ–º–Ω–∞—è —Ç–µ–ø–ª–æ–µ–º–∫–æ—Å—Ç—å –º–µ—Ä–∑–ª–∞—è (Cf):</span>
                                <div class="result-average"><span id="cf-value">-</span> √ó10‚Åª‚Å∂ –î–∂/(–∫–≥¬∑¬∞–°)</div>
                            </div>
                            <div class="average-row">
                                <span class="average-label">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–æ–ø—Ä–æ–≤–æ–¥–Ω–æ—Å—Ç—å —Ç–∞–ª–∞—è (ath):</span>
                                <div class="result-average"><span id="ath-value">-</span> √ó10‚Åª‚Å∂ –º¬≤/—Å</div>
                            </div>
                            <div class="average-row">
                                <span class="average-label">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–æ–ø—Ä–æ–≤–æ–¥–Ω–æ—Å—Ç—å –º–µ—Ä–∑–ª–∞—è (af):</span>
                                <div class="result-average"><span id="af-value">-</span> √ó10‚Åª‚Å∂ –º¬≤/—Å</div>
                            </div>
                        </div>
                        <div class="action-row">
                            <div>
                                <button class="btn-calc-green" onclick="App.calculateTest(this, 'thermophysics')" aria-label="–†–∞—Å—Å—á–∏—Ç–∞—Ç—å">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
                                <button class="btn-clear" onclick="App.clearTest(this)" aria-label="–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª—è">–û—á–∏—Å—Ç–∏—Ç—å</button>
                                                            </div>
                        </div>
                    `;
                }

                calcDiv.innerHTML = sampleContent;
                calcWrapper.appendChild(calcDiv);
                testFlex.appendChild(calcWrapper);

                const deleteBtn = document.createElement("button");
                deleteBtn.classList.add("delete-btn");
                deleteBtn.textContent = "–£–¥–∞–ª–∏—Ç—å";
                deleteBtn.setAttribute("aria-label", "–£–¥–∞–ª–∏—Ç—å –∏—Å–ø—ã—Ç–∞–Ω–∏–µ");
                deleteBtn.onclick = () => testFlex.remove();
                testFlex.appendChild(deleteBtn);

                container.appendChild(testFlex);
            },

            toggleConsistency(select) {
                const consistencySelect = select.parentElement.querySelector(".consistency");
                consistencySelect.disabled = select.value === "sand";
            },

            findThermalProperties(pd, W, soilType) {
                let data;
                if (soilType === "sand") {
                    data = this.sandThermalData;
                } else if (soilType === "loamy_sand") {
                    data = this.loamySandThermalData;
                } else {
                    data = this.loamClayThermalData;
                }

                const match = data.find(entry => Math.abs(entry.pd - pd) < 0.01 && Math.abs(entry.W - W) < 0.01);
                if (match) {
                    return { Œªth: match.Œªth, Œªf: match.Œªf };
                }

                // Fallback to closest match or extrapolation (using nearest point)
                const closest = data.reduce((prev, curr) => {
                    const prevDist = Math.sqrt((prev.pd - pd) ** 2 + (prev.W - W) ** 2);
                    const currDist = Math.sqrt((curr.pd - pd) ** 2 + (curr.W - W) ** 2);
                    return currDist < prevDist ? curr : prev;
                });
                return { Œªth: closest.Œªth, Œªf: closest.Œªf };
            },

            findHeatCapacity(pd, W) {
                const match = this.heatCapacityData.find(entry => Math.abs(entry.pd - pd) < 0.01 && Math.abs(entry.W - W) < 0.01);
                if (match) {
                    return { Cth: match.Cth, Cf: match.Cf };
                }

                // Fallback to closest match
                const closest = this.heatCapacityData.reduce((prev, curr) => {
                    const prevDist = Math.sqrt((prev.pd - pd) ** 2 + (prev.W - W) ** 2);
                    const currDist = Math.sqrt((curr.pd - pd) ** 2 + (curr.W - W) ** 2);
                    return currDist < prevDist ? curr : prev;
                });
                return { Cth: closest.Cth, Cf: closest.Cf };
            },

            calculateTest(btn, method) {
                const block = btn.closest(".test-flex");
                if (method === 'moisture') {
                    const sample = block.querySelector("#initial-moisture-block");
                    const boxWeight = parseFloat(sample.querySelector(".box-weight").value);
                    const wetWeight = parseFloat(sample.querySelector(".wet-weight").value);
                    const dryWeight = parseFloat(sample.querySelector(".dry-weight").value);

                    if (isNaN(boxWeight) || isNaN(wetWeight) || isNaN(dryWeight) || boxWeight < 0 || wetWeight <= boxWeight || dryWeight < boxWeight) {
                        sample.querySelector("#result-moisture").textContent = "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ";
                        document.getElementById("wtot-value").textContent = "-";
                        return;
                    }

                    const wtot = (((100 * (wetWeight - dryWeight)) / (dryWeight - boxWeight)) * 0.01).toFixed(3);
                    document.getElementById("wtot-value").textContent = wtot;
                    sample.querySelector("#result-moisture").textContent = `Wtot —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–∞: ${wtot} –¥.–µ.`;
                    document.getElementById("btn-continue-moisture").style.display = "inline-block";
                } else if (method === 'ice') {
                    const sample = block.querySelector(".sample-block");
                    const wtot = parseFloat(sample.querySelector(".wtot").value);
                    const ww = parseFloat(sample.querySelector(".ww").value);
                    const p = parseFloat(sample.querySelector(".p").value);
                    const wm = parseFloat(sample.querySelector(".wm").value);
                    const wic = parseFloat(sample.querySelector(".wic").value);
                    const ps = parseFloat(sample.querySelector(".ps").value);
                    const e = parseFloat(sample.querySelector(".e").value);

                    if (isNaN(wtot) || isNaN(ww) || isNaN(p) || isNaN(wm) || isNaN(wic) || isNaN(ps) || isNaN(e) ||
                        wtot < 0 || ww < 0 || p <= 0 || wm < 0 || wic < 0 || ps <= 0 || e < 0 || e > 1) {
                        sample.querySelector("#result-ice").textContent = "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ";
                        document.getElementById("itot-value").textContent = "-";
                        document.getElementById("ii-value").textContent = "-";
                        document.getElementById("iic-value").textContent = "-";
                        document.getElementById("sr-value").textContent = "-";
                        return;
                    }

                    const itot = (((wtot - ww) * p) / ((1 + wtot) * 0.9)).toFixed(3);
                    const ii = (ps * (wtot - wm) / (0.9 + ps * (wtot - 0.1 * ww))).toFixed(3);
                    const iic = (itot - ii).toFixed(3);
                    const sr = ((1.1 * wic + ww) * ps / e).toFixed(3);

                    document.getElementById("itot-value").textContent = itot;
                    document.getElementById("ii-value").textContent = ii;
                    document.getElementById("iic-value").textContent = iic;
                    document.getElementById("sr-value").textContent = sr;
                    sample.querySelector("#result-ice").textContent = "–†–∞—Å—á—ë—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω";
                } else if (method === 'thermophysics') {
                    const samples = block.querySelectorAll(".sample-block");
                    let totalLth = 0, totalLf = 0, totalCmth = 0, totalCmf = 0, totalCth = 0, totalCf = 0, totalAth = 0, totalAf = 0;
                    let validSamples = 0;

                    samples.forEach(sample => {
                        const pd = parseFloat(sample.querySelector(".pd").value);
                        const W = parseFloat(sample.querySelector(".W").value);
                        const soilType = sample.querySelector(".soil-type").value;

                        if (isNaN(pd) || isNaN(W) || pd <= 0 || W < 0) {
                            sample.querySelector("#result-thermophysics").textContent = "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ";
                            return;
                        }

                        const thermal = this.findThermalProperties(pd, W, soilType);
                        const heat = this.findHeatCapacity(pd, W);

                        const Œªth = thermal.Œªth;
                        const Œªf = thermal.Œªf;
                        const Cth = heat.Cth;
                        const Cf = heat.Cf;

                        const Cmth = Math.round(Cth * 1000 / pd);
                        const Cmf = Math.round(Cf * 1000 / pd);
                        const ath = (Œªth / Cmth * 1000).toFixed(3);
                        const af = (Œªf / Cmf * 1000).toFixed(3);

                        totalLth += Œªth;
                        totalLf += Œªf;
                        totalCmth += Cmth;
                        totalCmf += Cmf;
                        totalCth += Cth;
                        totalCf += Cf;
                        totalAth += parseFloat(ath);
                        totalAf += parseFloat(af);
                        validSamples++;

                        sample.querySelector("#result-thermophysics").textContent = "–†–∞—Å—Å—á–∏—Ç–∞–Ω–æ";
                    });

                    if (validSamples === 0) {
                        block.querySelector("#lth-value").textContent = "-";
                        block.querySelector("#lf-value").textContent = "-";
                        block.querySelector("#cmth-value").textContent = "-";
                        block.querySelector("#cmf-value").textContent = "-";
                        block.querySelector("#cth-value").textContent = "-";
                        block.querySelector("#cf-value").textContent = "-";
                        block.querySelector("#ath-value").textContent = "-";
                        block.querySelector("#af-value").textContent = "-";
                        return;
                    }

                    block.querySelector("#lth-value").textContent = (totalLth / validSamples).toFixed(2);
                    block.querySelector("#lf-value").textContent = (totalLf / validSamples).toFixed(2);
                    block.querySelector("#cmth-value").textContent = (totalCmth / validSamples).toFixed(0);
                    block.querySelector("#cmf-value").textContent = (totalCmf / validSamples).toFixed(0);
                    block.querySelector("#cth-value").textContent = (totalCth / validSamples).toFixed(2);
                    block.querySelector("#cf-value").textContent = (totalCf / validSamples).toFixed(2);
                    block.querySelector("#ath-value").textContent = (totalAth / validSamples).toFixed(3);
                    block.querySelector("#af-value").textContent = (totalAf / validSamples).toFixed(3);
                }
            },

            clearTest(btn) {
                const calcDiv = btn.closest(".calculation-container");
                calcDiv.querySelectorAll(".sample-block input, .sample-block select").forEach(input => input.value = "");
                calcDiv.querySelectorAll(".sample-result, .density-value, #wm-value, #wi-value, #ww-value, #wic-value, #itot-value, #ii-value, #iic-value, #sr-value, #lth-value, #lf-value, #cmth-value, #cmf-value, #cth-value, #cf-value, #ath-value, #af-value").forEach(el => el.textContent = "-");
                if (calcDiv.querySelector("#btn-continue-moisture")) {
                    calcDiv.querySelector("#btn-continue-moisture").style.display = "none";
                    calcDiv.querySelector("#manual-wtot-row").style.display = "none";
                    calcDiv.querySelector("#extra-result-moisture").style.display = "none";
                    calcDiv.querySelector("#wtot-container").style.display = "block";
                    calcDiv.querySelector("#initial-moisture-block").style.display = "block";
                    calcDiv.querySelector("#manual-toggle-moisture").style.display = "inline-block";
                    calcDiv.querySelector("#calc-extra-moisture").style.display = "none";
                }
            },

            continueCalculation(method, step) {
                if (method === 'moisture') {
                    const calcDiv = document.getElementById("test-container-moisture").querySelector(".calculation-container");
                    if (step === 1) {
                        document.getElementById("extra-result-moisture").style.display = "block";
                        document.getElementById("calc-extra-moisture").style.display = "inline-block";
                    }
                }
            },

            useManualWtot(btn) {
                const calcDiv = btn.closest(".calculation-container");
                const manualWtot = parseFloat(calcDiv.querySelector(".manual-wtot").value);

                if (isNaN(manualWtot) || manualWtot < 0) {
                    calcDiv.querySelector("#result-moisture").textContent = "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ Wtot";
                    document.getElementById("wtot-value").textContent = "-";
                    return;
                }

                document.getElementById("wtot-value").textContent = manualWtot.toFixed(3);
                calcDiv.querySelector("#result-moisture").textContent = "Wtot –ø—Ä–∏–Ω—è—Ç–∞ –≤—Ä—É—á–Ω—É—é";
                document.getElementById("btn-continue-moisture").style.display = "none";
                document.getElementById("extra-result-moisture").style.display = "block";
                document.getElementById("calc-extra-moisture").style.display = "inline-block";
            },

            toggleManualInput(method) {
                const calcDiv = document.getElementById(`test-container-${method}`).querySelector(".calculation-container");
                const initialBlock = calcDiv.querySelector("#initial-moisture-block");
                const wtotContainer = calcDiv.querySelector("#wtot-container");
                const manualRow = calcDiv.querySelector("#manual-wtot-row");
                const toggleBtn = calcDiv.querySelector("#manual-toggle-moisture");
                const actionRow = calcDiv.querySelector(".action-row");

                initialBlock.style.display = "none";
                wtotContainer.style.display = "none";
                actionRow.querySelector(".btn-calc-green").style.display = "none";
                actionRow.querySelector(".btn-clear").style.display = "none";
                toggleBtn.style.display = "none";
                manualRow.style.display = "block";
                document.getElementById("btn-continue-moisture").style.display = "none";
                document.getElementById("wtot-value").textContent = "-";
                document.getElementById("result-moisture").textContent = "-";
            },

            calculateExtra(method) {
                if (method === 'moisture') {
                    const calcDiv = document.getElementById("test-container-moisture").querySelector(".calculation-container");
                    const wp = parseFloat(calcDiv.querySelector(".wp").value);
                    const soilType = calcDiv.querySelector(".soil-type").value;
                    const consistency = calcDiv.querySelector(".consistency").value;
                    const wtot = parseFloat(document.getElementById("wtot-value").textContent);

                    if (isNaN(wp) || wp < 0 || isNaN(wtot) || wtot < 0) {
                        calcDiv.querySelector("#result-moisture").textContent = "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞";
                        document.getElementById("wm-value").textContent = "-";
                        document.getElementById("wi-value").textContent = "-";
                        document.getElementById("ww-value").textContent = "-";
                        document.getElementById("wic-value").textContent = "-";
                        return;
                    }

                    const kw = { sand: 0, loamy_sand: 0.4, light_loam: 0.6, heavy_loam: 0.65, clay: 0.9 };
                    const ww = (kw[soilType] * wp).toFixed(3);

                    let wm;
                    if (soilType === "sand" || consistency === "hard" || consistency === "semi_hard") {
                        wm = wtot - 0.01;
                    } else if (consistency === "tough_plastic" || consistency === "soft_plastic") {
                        wm = wp;
                    } else if (consistency === "flowing_plastic" || consistency === "flowing") {
                        const randomSubtraction = 0.01 + Math.random() * (0.03 - 0.01);
                        wm = wp - randomSubtraction;
                    }
                    wm = parseFloat(wm.toFixed(3));

                    if (wm < 0) {
                        calcDiv.querySelector("#result-moisture").textContent = "Wm –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º";
                        document.getElementById("wm-value").textContent = "-";
                        document.getElementById("wi-value").textContent = "-";
                        document.getElementById("ww-value").textContent = "-";
                        document.getElementById("wic-value").textContent = "-";
                        return;
                    }

                    const wi = (wtot - wm).toFixed(3);

                    if (wi < 0) {
                        calcDiv.querySelector("#result-moisture").textContent = "Wi –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º";
                        document.getElementById("wm-value").textContent = "-";
                        document.getElementById("wi-value").textContent = "-";
                        document.getElementById("ww-value").textContent = "-";
                        document.getElementById("wic-value").textContent = "-";
                        return;
                    }

                    const wic = (wm - parseFloat(ww)).toFixed(3);

                    if (wic < 0) {
                        calcDiv.querySelector("#result-moisture").textContent = "Wic –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º";
                        document.getElementById("wm-value").textContent = "-";
                        document.getElementById("wi-value").textContent = "-";
                        document.getElementById("ww-value").textContent = "-";
                        document.getElementById("wic-value").textContent = "-";
                        return;
                    }

                    document.getElementById("wm-value").textContent = wm;
                    document.getElementById("wi-value").textContent = wi;
                    document.getElementById("ww-value").textContent = ww;
                    document.getElementById("wic-value").textContent = wic;
                    calcDiv.querySelector("#result-moisture").textContent = "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞—Å—Å—á–∏—Ç–∞–Ω—ã";
                }
            },

            addSample(btn, method) {
                const calcDiv = btn.closest(".calculation-container");
                const sampleCount = calcDiv.querySelectorAll(".sample-block").length + 1;
                const sampleBlock = document.createElement("div");
                sampleBlock.classList.add("sample-block");
                sampleBlock.style.animationDelay = `${(sampleCount - 1) * 0.15}s`;

                let sampleContent;
                if (method === 'moisture') {
                    sampleContent = `
                        <div class="sample-content">
                            <div class="sample-row">
                                <input type="number" class="box-weight" placeholder="–í–µ—Å –±—é–∫—Å–∞, –≥" aria-label="–í–µ—Å –±—é–∫—Å–∞" onkeypress="App.focusNextInput(event, this)">
                                <input type="number" class="wet-weight" placeholder="–í–µ—Å –±—é–∫—Å–∞ —Å –≤–ª–∞–∂–Ω—ã–º –≥—Ä—É–Ω—Ç–æ–º, –≥" aria-label="–í–µ—Å –±—é–∫—Å–∞ —Å –≤–ª–∞–∂–Ω—ã–º –≥—Ä—É–Ω—Ç–æ–º" onkeypress="App.focusNextInput(event, this)">
                                <input type="number" class="dry-weight" placeholder="–í–µ—Å –±—é–∫—Å–∞ —Å —Å—É—Ö–∏–º –≥—Ä—É–Ω—Ç–æ–º, –≥" aria-label="–í–µ—Å –±—é–∫—Å–∞ —Å —Å—É—Ö–∏–º –≥—Ä—É–Ω—Ç–æ–º" onkeypress="App.focusNextInput(event, this)">
                            </div>
                        </div>
                        <div class="sample-result" id="result-moisture">-</div>
                        <button class="btn-delete-sample" onclick="App.deleteSample(this)" aria-label="–£–¥–∞–ª–∏—Ç—å –æ–±—Ä–∞–∑–µ—Ü">‚Äî</button>
                    `;
                } else if (method === 'ice') {
                    sampleContent = `
                        <div class="sample-content">
                            <div class="sample-row">
                                <input type="number" class="wtot" placeholder="–°—É–º–º–∞—Ä–Ω–∞—è –≤–ª–∞–∂–Ω–æ—Å—Ç—å (Wtot), –¥.–µ." aria-label="–°—É–º–º–∞—Ä–Ω–∞—è –≤–ª–∞–∂–Ω–æ—Å—Ç—å" onkeypress="App.focusNextInput(event, this)">
                                <input type="number" class="wm" placeholder="–í–ª–∞–∂–Ω–æ—Å—Ç—å –º–µ–∂–¥—É –ø—Ä–æ—Å–ª–æ–π–∫–∞–º–∏ (Wm), –¥.–µ." aria-label="–í–ª–∞–∂–Ω–æ—Å—Ç—å –º–µ–∂–¥—É –ø—Ä–æ—Å–ª–æ–π–∫–∞–º–∏" onkeypress="App.focusNextInput(event, this)">
                                <input type="number" class="ww" placeholder="–í–ª–∞–∂–Ω–æ—Å—Ç—å –∑–∞ —Å—á—ë—Ç –Ω–µ–∑–∞–º–µ—Ä–∑—à–µ–π –≤–æ–¥—ã (Ww), –¥.–µ." aria-label="–í–ª–∞–∂–Ω–æ—Å—Ç—å –∑–∞ —Å—á—ë—Ç –Ω–µ–∑–∞–º–µ—Ä–∑—à–µ–π –≤–æ–¥—ã" onkeypress="App.focusNextInput(event, this)">
                                <input type="number" class="wic" placeholder="–í–ª–∞–∂–Ω–æ—Å—Ç—å –ø–æ—Ä–æ–≤–æ–≥–æ –ª—å–¥–∞ (Wic), –¥.–µ." aria-label="–í–ª–∞–∂–Ω–æ—Å—Ç—å –ø–æ—Ä–æ–≤–æ–≥–æ –ª—å–¥–∞" onkeypress="App.focusNextInput(event, this)">
                                <input type="number" class="p" placeholder="–ü–ª–æ—Ç–Ω–æ—Å—Ç—å (p), –≥/—Å–º¬≥" aria-label="–ü–ª–æ—Ç–Ω–æ—Å—Ç—å" onkeypress="App.focusNextInput(event, this)">
                                <input type="number" class="ps" placeholder="–ü–ª–æ—Ç–Ω–æ—Å—Ç—å —á–∞—Å—Ç–∏—Ü –≥—Ä—É–Ω—Ç–∞ (ps), –≥/—Å–º¬≥" aria-label="–ü–ª–æ—Ç–Ω–æ—Å—Ç—å —á–∞—Å—Ç–∏—Ü –≥—Ä—É–Ω—Ç–∞" onkeypress="App.focusNextInput(event, this)">
                                <input type="number" class="e" placeholder="–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ø–æ—Ä–∏—Å—Ç–æ—Å—Ç–∏ (e), –¥.–µ." aria-label="–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ø–æ—Ä–∏—Å—Ç–æ—Å—Ç–∏" onkeypress="App.focusNextInput(event, this)">
                            </div>
                        </div>
                        <div class="sample-result" id="result-ice">-</div>
                        <button class="btn-delete-sample" onclick="App.deleteSample(this)" aria-label="–£–¥–∞–ª–∏—Ç—å –æ–±—Ä–∞–∑–µ—Ü">‚Äî</button>
                    `;
                } else if (method === 'thermophysics') {
                    sampleContent = `
                        <div class="sample-content">
                            <div class="sample-row">
                                <input type="number" class="pd" placeholder="–ü–ª–æ—Ç–Ω–æ—Å—Ç—å —Å—É—Ö–æ–≥–æ –≥—Ä—É–Ω—Ç–∞ (pd), –≥/—Å–º¬≥" aria-label="–ü–ª–æ—Ç–Ω–æ—Å—Ç—å —Å—É—Ö–æ–≥–æ –≥—Ä—É–Ω—Ç–∞" onkeypress="App.focusNextInput(event, this)">
                                <input type="number" class="W" placeholder="–í–ª–∞–∂–Ω–æ—Å—Ç—å –≥—Ä—É–Ω—Ç–∞ (W), –¥.–µ." aria-label="–í–ª–∞–∂–Ω–æ—Å—Ç—å –≥—Ä—É–Ω—Ç–∞" onkeypress="App.focusNextInput(event, this)">
                                <select class="soil-type" aria-label="–¢–∏–ø –≥—Ä—É–Ω—Ç–∞">
                                    <option value="sand">–ü–µ—Å–æ–∫</option>
                                    <option value="loamy_sand">–°—É–ø–µ—Å—å</option>
                                    <option value="loam">–°—É–≥–ª–∏–Ω–æ–∫</option>
                                    <option value="clay">–ì–ª–∏–Ω–∞</option>
                                </select>
                            </div>
                        </div>
                        <div class="sample-result" id="result-thermophysics">-</div>
                        <button class="btn-delete-sample" onclick="App.deleteSample(this)" aria-label="–£–¥–∞–ª–∏—Ç—å –æ–±—Ä–∞–∑–µ—Ü">‚Äî</button>
                    `;
                }

                sampleBlock.innerHTML = sampleContent;
                calcDiv.insertBefore(sampleBlock, calcDiv.querySelector(".average-container"));
            },

            deleteSample(btn) {
                const calcDiv = btn.closest(".calculation-container");
                btn.closest(".sample-block").remove();
                const method = calcDiv.querySelector(".btn-calc-green").getAttribute("onclick").match(/'([^']+)'/)[1];
                this.calculateTest(calcDiv.querySelector(".btn-calc-green"), method);
            }
        };

        App.init();
    </script>
</body>
</html>